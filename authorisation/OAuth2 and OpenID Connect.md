# OAuth 2.0 and OpenID Connect
- Security standard where you give one application permission to access your data in another application.
- This is done with a key (rather than a password) which gives the application permission to the other application.

## Openid Connect (OIDC)
This is a thin layer which sits on top of oauth 2.0 that adds functionality around login and profile information about the person who is logged in. OIDC allows a client to establish a login session on top of the oauth layer.

When an authorisation server supports OIDC, it's sometimes called an "Identity Provider" as it provides identity information about the resource owner, back to the client.

OIDC relies upon the oauth 2.0 framework in order to work.

## Terminology
- Resource Owner: You - the owner the data or resource you're allowing an app to access
- Client: The application which wants to access data from the other application. (App 1 in the below "Authorisation Code Flow" example)
- Authorisation Server: The application which knows the resource owner. (App 2 in the below "Authorisation Code Flow" example)
- Resource Server: The application which has the resource which the client wants to use on behalf of the resource owner. Sometimes the Resource Server and the Authorisation Server will be the same but this isn't always the case. Sometimes the Auth server is a 3rd party server which the resource server trusts.
- Redirect URI: A callback URL which the user will get redirected to after authorising the client.
- Response type: The type of response. Most common is "code", which tells the auth server that it's expecting an authorisation code back.
- Scope: The granualar permissions the client is requesting
- Consent: The authorisation server will ask the user consent in allowing the client the permissions requested in the scope.
- Client ID: Public ID of the application when the developer registered the application with the authorisation server.
- Client Secret: Only the Client and the Authorisation Server know this. It would have been genereated by the Authorisation Server when the Client was registered with the Auth server.
- Authorisation Code: short lived code which is returned to the client when the user has authorised the application. This code is used by the client to retrieve a token from the Auth Server.
- Access Token: The key used by the client to access data from the resource server.

## OAuth Flow
### Authorisation Code Flow 
1. App 1 takes you to an authorisation server for App 2 (eg Google, Facebook etc)
1. The request URL includes
    1. A redirect URI which takes you back to App 1, once you've auth'd with App 2
    1. Scope (list of permissions App 1 is asking for from App 2)
    1. State (random string which is checked by App 1 after the user authorises. This is used to prevent Cross Site Request Forgery (CSRF) attacks)
    1. Client ID (Public identifier of the application when the developer registered the application)
    1. Reponse Type (eg "code" tells the authorisation server that it's initiating the authorisation code flow)
1. After the user has authorised the application, they're redirected back to the redirect URI which was included in the request along with a "code" and "state" in the query string.
    1. The state is checked to make sure it's not different from the one that was provided in the request
    1. The code is an authorisation code generated by the authorisation server. It's usually short lived (between 1 and 10 minutes).
1. With the authorisation code, App 1 can now get an access token. This is done with a POST to the service's token endpoint with the following parameters:
    1. Grant type (eg "authorisation_code" tells the token endpoint that the application is using the Authorization Code grant type)
    1. Code - the code it was given by the auth server in the previous step
    1. Redirect URI - Same redirect URI as in the previous step (some APIs don't require this)
    1. Client ID (public ID for the app)
    1. Client Secret (The application's client secret. This ensures that the request to get the access token is made only from the application and not from a potential attacker that intercepted the authorisation code)
1. App 2 will verify the details above, ensure the code hasn't expired and the client ID and secret match and if everything checks out, will generate an access token and return it in the response. 
1. From now on, App 1 uses the access token to make API requests to App 2.

## OIDC Flow
This is similar to the OAuth Flow:
1. Client makes the request to the authorisation server for App 2 (Google, Facebook, etc)
1. The request includes the same info as mentioned above (Client ID, redirect URI, response type, except with a scope of **OPENID**. This lets the authorisation server know this will be an OIDC exchange.
1. The user is redirected back to the client along with an authorisation code (same as the OAuth flow)
1. The client then makes a request to the authorisation server with the client id, client secret and authorisation code and retrieves an access token **and** an **ID Token**. The access token is a string which the client doesn't understand but the ID Token is a JWT with identity information contained in it.
